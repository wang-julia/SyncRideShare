import { type FlowgladServer } from '@flowglad/server';
import type { HTTPMethod } from '@flowglad/shared';
import type { NextApiRequest, NextApiResponse } from 'next';
/**
 * Options for creating a Next.js Pages Router API route handler with scoped FlowgladServer instances.
 */
export interface PagesRouteHandlerOptions {
    /**
     * Function to extract the customer external ID from the Next.js request.
     * The customerExternalId should be from YOUR app's database (e.g., user.id or organization.id),
     * NOT Flowglad's customer ID.
     *
     * @param req - The Next.js API request object
     * @returns The customer external ID from your app's database
     */
    getCustomerExternalId: (req: NextApiRequest) => Promise<string>;
    /**
     * Function that creates a FlowgladServer instance for a specific customer.
     * @param customerExternalId - The customer's external ID
     * @returns A FlowgladServer instance scoped to that customer
     */
    flowglad: (customerExternalId: string) => Promise<FlowgladServer> | FlowgladServer;
    /**
     * Function to run when an error occurs.
     */
    onError?: (error: unknown) => void;
    /**
     * Side effect to run before the request is processed.
     */
    beforeRequest?: (req: NextApiRequest, context: {
        path: string[];
        method: HTTPMethod;
        query?: Record<string, string>;
        body?: unknown;
    }) => Promise<void>;
    /**
     * Side effect to run after the request is processed.
     */
    afterRequest?: (req: NextApiRequest, result: {
        status: number;
        data?: unknown;
        error?: unknown;
    }) => Promise<void>;
}
/**
 * Creates a Next.js Pages Router API route handler with per-request scoped FlowgladServer instances.
 *
 * This handler dynamically creates a FlowgladServer for each request based on the customer ID
 * extracted from the request. This pattern is useful when you want to scope billing operations
 * to a specific customer (either user or organization level, as defined in your flowglad server constructor)
 * without requiring full authentication setup in the constructor.
 *
 * @param options - Configuration options for the route handler
 * @returns A Next.js Pages Router API handler function
 *
 * @example
 * ```typescript
 * // In your lib/flowglad.ts
 * import { FlowgladServer } from '@flowglad/server'
 *
 * export const flowglad = (customerExternalId: string) => {
 *   return new FlowgladServer({
 *     customerExternalId,
 *     getCustomerDetails: async (externalId) => {
 *       const user = await db.users.findOne({ id: externalId })
 *       return {
 *         email: user.email,
 *         name: user.name,
 *       }
 *     },
 *   })
 * }
 *
 * // In your pages/api/flowglad/[...path].ts
 * import { pagesRouteHandler } from '@flowglad/nextjs/server'
 * import { flowglad } from '@/lib/flowglad'
 * import { verifyToken } from '@/lib/auth'
 *
 * export default pagesRouteHandler({
 *   getCustomerExternalId: async (req) => {
 *     const token = req.headers.authorization?.split(' ')[1]
 *     if (!token) throw new Error('Unauthorized')
 *     const decoded = await verifyToken(token)
 *     return decoded.userId
 *   },
 *   flowglad,
 * })
 * ```
 */
export declare const pagesRouteHandler: (options: PagesRouteHandlerOptions) => ((req: NextApiRequest, res: NextApiResponse) => Promise<void>);
