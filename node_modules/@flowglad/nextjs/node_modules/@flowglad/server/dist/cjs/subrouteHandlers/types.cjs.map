{"version":3,"sources":["../../../src/subrouteHandlers/types.ts"],"sourcesContent":["import type {\n  FlowgladActionKey,\n  flowgladActionValidators,\n} from '@flowglad/shared'\nimport type { z } from 'zod'\nimport type { FlowgladServer } from '../FlowgladServer'\nimport type { FlowgladServerAdmin } from '../FlowgladServerAdmin'\n\nexport type { GetPricingModelResponse } from '@flowglad/shared'\n\nexport type InferRouteHandlerParams<T extends FlowgladActionKey> = {\n  method: (typeof flowgladActionValidators)[T]['method']\n  data: z.infer<\n    (typeof flowgladActionValidators)[T]['inputValidator']\n  >\n}\n\nexport type SubRouteHandler<T extends FlowgladActionKey> = (\n  params: InferRouteHandlerParams<T>,\n  flowgladServer: FlowgladServer\n) => Promise<{\n  data: {}\n  status: number\n  error?: {\n    code: string\n    json: Record<string, unknown>\n  }\n}>\n\nexport type SubRouteHandlerResult<T extends FlowgladActionKey> =\n  Awaited<ReturnType<SubRouteHandler<T>>>\n\nexport type SubRouteHandlerResultData<T extends FlowgladActionKey> =\n  SubRouteHandlerResult<T>['data']\n\n/**\n * Handler for routes that attempt authentication but gracefully fall back\n * to unauthenticated behavior if auth fails.\n *\n * The framework (requestHandler or better-auth) handles the auth logic:\n * - Attempts to authenticate the request\n * - If auth succeeds: flowgladServer is populated\n * - If auth fails: flowgladServer is null\n *\n * The handler then branches based on whether flowgladServer is available.\n *\n * IMPORTANT: The handler must NOT silently fall back if flowgladServer is\n * non-null but a subsequent API call fails. Only fall back when\n * flowgladServer is null (meaning auth was never established).\n */\nexport type HybridSubRouteHandler<T extends FlowgladActionKey> = (\n  params: InferRouteHandlerParams<T>,\n  context: {\n    /** FlowgladServer instance if authentication succeeded, null otherwise */\n    flowgladServer: FlowgladServer | null\n    /** FlowgladServerAdmin instance (always available) */\n    flowgladServerAdmin: FlowgladServerAdmin\n  }\n) => Promise<{\n  data: Record<string, unknown>\n  status: number\n  error?: {\n    code: string\n    json: Record<string, unknown>\n  }\n}>\n"],"mappings":";;;;;;;;;;;;;;AAAA;AAAA;","names":[]}