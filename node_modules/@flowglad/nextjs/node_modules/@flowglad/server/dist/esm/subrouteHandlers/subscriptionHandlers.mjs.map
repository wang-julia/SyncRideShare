{"version":3,"sources":["../../../src/subrouteHandlers/subscriptionHandlers.ts"],"sourcesContent":["import type Flowglad from '@flowglad/node'\nimport { type FlowgladActionKey, HTTPMethod } from '@flowglad/shared'\nimport type { FlowgladServer } from '../FlowgladServer'\nimport type {\n  SubRouteHandler,\n  SubRouteHandlerResultData,\n} from './types'\n\nexport const cancelSubscription: SubRouteHandler<\n  FlowgladActionKey.CancelSubscription\n> = async (params, flowgladServer: FlowgladServer) => {\n  let error:\n    | { code: string; json: Record<string, unknown> }\n    | undefined\n  let status: number\n  const data: SubRouteHandlerResultData<FlowgladActionKey.CancelSubscription> =\n    {}\n  if (params.method !== HTTPMethod.POST) {\n    error = {\n      code: 'Method not allowed',\n      json: {},\n    }\n    status = 405\n    return {\n      data,\n      status,\n      error,\n    }\n  }\n  let subscription: Flowglad.Subscriptions.SubscriptionCancelResponse\n  try {\n    subscription = await flowgladServer.cancelSubscription(\n      params.data\n    )\n    return {\n      data: subscription,\n      status: 200,\n    }\n  } catch (error) {\n    return {\n      data: {},\n      status: 500,\n      error: {\n        code: 'subscription_cancel_failed',\n        json: {\n          message: (error as Error).message,\n        },\n      },\n    }\n  }\n}\n\nexport const uncancelSubscription: SubRouteHandler<\n  FlowgladActionKey.UncancelSubscription\n> = async (params, flowgladServer: FlowgladServer) => {\n  let error:\n    | { code: string; json: Record<string, unknown> }\n    | undefined\n  let status: number\n  const data: SubRouteHandlerResultData<FlowgladActionKey.UncancelSubscription> =\n    {}\n  if (params.method !== HTTPMethod.POST) {\n    error = {\n      code: 'Method not allowed',\n      json: {},\n    }\n    status = 405\n    return {\n      data,\n      status,\n      error,\n    }\n  }\n  let subscription: Flowglad.Subscriptions.SubscriptionUncancelResponse\n  try {\n    subscription = await flowgladServer.uncancelSubscription(\n      params.data\n    )\n    return {\n      data: subscription,\n      status: 200,\n    }\n  } catch (error) {\n    return {\n      data: {},\n      status: 500,\n      error: {\n        code: 'subscription_uncancel_failed',\n        json: {\n          message: (error as Error).message,\n        },\n      },\n    }\n  }\n}\n\nexport const adjustSubscription: SubRouteHandler<\n  FlowgladActionKey.AdjustSubscription\n> = async (params, flowgladServer: FlowgladServer) => {\n  const data: SubRouteHandlerResultData<FlowgladActionKey.AdjustSubscription> =\n    {}\n  if (params.method !== HTTPMethod.POST) {\n    return {\n      data,\n      status: 405,\n      error: {\n        code: 'Method not allowed',\n        json: {},\n      },\n    }\n  }\n  try {\n    const result = await flowgladServer.adjustSubscription(\n      params.data\n    )\n    return {\n      data: result,\n      status: 200,\n    }\n  } catch (error) {\n    return {\n      data: {},\n      status: 500,\n      error: {\n        code: 'subscription_adjust_failed',\n        json: {\n          message: (error as Error).message,\n        },\n      },\n    }\n  }\n}\n"],"mappings":";;;AACA,SAAiC,kBAAkB;AAO5C,MAAM,qBAET,CAAO,QAAQ,mBAAmC;AACpD,MAAI;AAGJ,MAAI;AACJ,QAAM,OACJ,CAAC;AACH,MAAI,OAAO,WAAW,WAAW,MAAM;AACrC,YAAQ;AAAA,MACN,MAAM;AAAA,MACN,MAAM,CAAC;AAAA,IACT;AACA,aAAS;AACT,WAAO;AAAA,MACL;AAAA,MACA;AAAA,MACA;AAAA,IACF;AAAA,EACF;AACA,MAAI;AACJ,MAAI;AACF,mBAAe,MAAM,eAAe;AAAA,MAClC,OAAO;AAAA,IACT;AACA,WAAO;AAAA,MACL,MAAM;AAAA,MACN,QAAQ;AAAA,IACV;AAAA,EACF,SAASA,QAAO;AACd,WAAO;AAAA,MACL,MAAM,CAAC;AAAA,MACP,QAAQ;AAAA,MACR,OAAO;AAAA,QACL,MAAM;AAAA,QACN,MAAM;AAAA,UACJ,SAAUA,OAAgB;AAAA,QAC5B;AAAA,MACF;AAAA,IACF;AAAA,EACF;AACF;AAEO,MAAM,uBAET,CAAO,QAAQ,mBAAmC;AACpD,MAAI;AAGJ,MAAI;AACJ,QAAM,OACJ,CAAC;AACH,MAAI,OAAO,WAAW,WAAW,MAAM;AACrC,YAAQ;AAAA,MACN,MAAM;AAAA,MACN,MAAM,CAAC;AAAA,IACT;AACA,aAAS;AACT,WAAO;AAAA,MACL;AAAA,MACA;AAAA,MACA;AAAA,IACF;AAAA,EACF;AACA,MAAI;AACJ,MAAI;AACF,mBAAe,MAAM,eAAe;AAAA,MAClC,OAAO;AAAA,IACT;AACA,WAAO;AAAA,MACL,MAAM;AAAA,MACN,QAAQ;AAAA,IACV;AAAA,EACF,SAASA,QAAO;AACd,WAAO;AAAA,MACL,MAAM,CAAC;AAAA,MACP,QAAQ;AAAA,MACR,OAAO;AAAA,QACL,MAAM;AAAA,QACN,MAAM;AAAA,UACJ,SAAUA,OAAgB;AAAA,QAC5B;AAAA,MACF;AAAA,IACF;AAAA,EACF;AACF;AAEO,MAAM,qBAET,CAAO,QAAQ,mBAAmC;AACpD,QAAM,OACJ,CAAC;AACH,MAAI,OAAO,WAAW,WAAW,MAAM;AACrC,WAAO;AAAA,MACL;AAAA,MACA,QAAQ;AAAA,MACR,OAAO;AAAA,QACL,MAAM;AAAA,QACN,MAAM,CAAC;AAAA,MACT;AAAA,IACF;AAAA,EACF;AACA,MAAI;AACF,UAAM,SAAS,MAAM,eAAe;AAAA,MAClC,OAAO;AAAA,IACT;AACA,WAAO;AAAA,MACL,MAAM;AAAA,MACN,QAAQ;AAAA,IACV;AAAA,EACF,SAAS,OAAO;AACd,WAAO;AAAA,MACL,MAAM,CAAC;AAAA,MACP,QAAQ;AAAA,MACR,OAAO;AAAA,QACL,MAAM;AAAA,QACN,MAAM;AAAA,UACJ,SAAU,MAAgB;AAAA,QAC5B;AAAA,MACF;AAAA,IACF;AAAA,EACF;AACF;","names":["error"]}