{"version":3,"sources":["../../../src/subrouteHandlers/usageMeterHandlers.ts"],"sourcesContent":["import {\n  type FlowgladActionKey,\n  getUsageMeterBalancesSchema,\n  HTTPMethod,\n} from '@flowglad/shared'\nimport type { FlowgladServer } from '../FlowgladServer'\nimport { parseErrorStringToErrorObject } from '../serverUtils'\nimport type {\n  SubRouteHandler,\n  SubRouteHandlerResultData,\n} from './types'\n\n/**\n * Handler for fetching usage meter balances for the authenticated customer.\n * Returns usage meter balances for current subscriptions, optionally filtered by subscriptionId.\n * Delegates to FlowgladServer.getUsageMeterBalances which calls the platform endpoint.\n */\nexport const getUsageMeterBalances: SubRouteHandler<\n  FlowgladActionKey.GetUsageMeterBalances\n> = async (params, flowgladServer: FlowgladServer) => {\n  let error:\n    | { code: string; json: Record<string, unknown> }\n    | undefined\n  let status: number\n  let data: SubRouteHandlerResultData<FlowgladActionKey.GetUsageMeterBalances> =\n    {}\n\n  if (params.method !== HTTPMethod.POST) {\n    error = {\n      code: 'Method not allowed',\n      json: {},\n    }\n    status = 405\n    return {\n      data,\n      status,\n      error,\n    }\n  }\n\n  try {\n    // Validate and parse input params\n    const parsedParams = getUsageMeterBalancesSchema.parse(\n      params.data\n    )\n\n    // Delegate to FlowgladServer method\n    const result =\n      await flowgladServer.getUsageMeterBalances(parsedParams)\n    data = result\n    status = 200\n  } catch (e) {\n    if (e instanceof Error) {\n      error = parseErrorStringToErrorObject(e.message)\n    } else {\n      error = {\n        code: 'Unknown error',\n        json: {},\n      }\n    }\n    status = 500\n  }\n\n  return {\n    data,\n    status,\n    error,\n  }\n}\n"],"mappings":";;;AAAA;AAAA,EAEE;AAAA,EACA;AAAA,OACK;AAEP,SAAS,qCAAqC;AAWvC,MAAM,wBAET,CAAO,QAAQ,mBAAmC;AACpD,MAAI;AAGJ,MAAI;AACJ,MAAI,OACF,CAAC;AAEH,MAAI,OAAO,WAAW,WAAW,MAAM;AACrC,YAAQ;AAAA,MACN,MAAM;AAAA,MACN,MAAM,CAAC;AAAA,IACT;AACA,aAAS;AACT,WAAO;AAAA,MACL;AAAA,MACA;AAAA,MACA;AAAA,IACF;AAAA,EACF;AAEA,MAAI;AAEF,UAAM,eAAe,4BAA4B;AAAA,MAC/C,OAAO;AAAA,IACT;AAGA,UAAM,SACJ,MAAM,eAAe,sBAAsB,YAAY;AACzD,WAAO;AACP,aAAS;AAAA,EACX,SAAS,GAAG;AACV,QAAI,aAAa,OAAO;AACtB,cAAQ,8BAA8B,EAAE,OAAO;AAAA,IACjD,OAAO;AACL,cAAQ;AAAA,QACN,MAAM;AAAA,QACN,MAAM,CAAC;AAAA,MACT;AAAA,IACF;AACA,aAAS;AAAA,EACX;AAEA,SAAO;AAAA,IACL;AAAA,IACA;AAAA,IACA;AAAA,EACF;AACF;","names":[]}