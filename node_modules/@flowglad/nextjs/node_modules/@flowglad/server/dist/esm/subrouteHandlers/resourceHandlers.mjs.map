{"version":3,"sources":["../../../src/subrouteHandlers/resourceHandlers.ts"],"sourcesContent":["import { type FlowgladActionKey, HTTPMethod } from '@flowglad/shared'\nimport type { FlowgladServer } from '../FlowgladServer'\nimport type { SubRouteHandler } from './types'\n\n/**\n * Handler for getting all resources with their usage for a customer's subscription.\n * Validates HTTP method and delegates to FlowgladServer.getResourceUsages().\n */\nexport const getResources: SubRouteHandler<\n  FlowgladActionKey.GetResourceUsages\n> = async (params, flowgladServer: FlowgladServer) => {\n  if (params.method !== HTTPMethod.POST) {\n    return {\n      data: {},\n      status: 405,\n      error: {\n        code: 'Method not allowed',\n        json: {},\n      },\n    }\n  }\n\n  try {\n    const result = await flowgladServer.getResourceUsages(params.data)\n    return {\n      data: result,\n      status: 200,\n    }\n  } catch (error) {\n    return {\n      data: {},\n      status: 500,\n      error: {\n        code: 'get_resources_failed',\n        json: {\n          message: (error as Error).message,\n        },\n      },\n    }\n  }\n}\n\n/**\n * Handler for getting usage for a single resource for a customer's subscription.\n * Validates HTTP method and delegates to FlowgladServer.getResourceUsage().\n */\nexport const getResourceUsage: SubRouteHandler<\n  FlowgladActionKey.GetResourceUsage\n> = async (params, flowgladServer: FlowgladServer) => {\n  if (params.method !== HTTPMethod.POST) {\n    return {\n      data: {},\n      status: 405,\n      error: {\n        code: 'Method not allowed',\n        json: {},\n      },\n    }\n  }\n\n  try {\n    const result = await flowgladServer.getResourceUsage(params.data)\n    return {\n      data: result,\n      status: 200,\n    }\n  } catch (error) {\n    return {\n      data: {},\n      status: 500,\n      error: {\n        code: 'get_resource_usage_failed',\n        json: {\n          message: (error as Error).message,\n        },\n      },\n    }\n  }\n}\n\n/**\n * Handler for claiming resources from a subscription's capacity.\n * Supports anonymous claims (quantity) and named claims (externalId/externalIds).\n * Validates HTTP method and delegates to FlowgladServer.claimResource().\n */\nexport const claimResource: SubRouteHandler<\n  FlowgladActionKey.ClaimResource\n> = async (params, flowgladServer: FlowgladServer) => {\n  if (params.method !== HTTPMethod.POST) {\n    return {\n      data: {},\n      status: 405,\n      error: {\n        code: 'Method not allowed',\n        json: {},\n      },\n    }\n  }\n\n  try {\n    const result = await flowgladServer.claimResource(params.data)\n    return {\n      data: result,\n      status: 200,\n    }\n  } catch (error) {\n    return {\n      data: {},\n      status: 500,\n      error: {\n        code: 'claim_resource_failed',\n        json: {\n          message: (error as Error).message,\n        },\n      },\n    }\n  }\n}\n\n/**\n * Handler for releasing claimed resources back to the subscription's available pool.\n * Supports anonymous release (quantity), named release (externalId/externalIds),\n * and direct release (claimIds).\n * Validates HTTP method and delegates to FlowgladServer.releaseResource().\n */\nexport const releaseResource: SubRouteHandler<\n  FlowgladActionKey.ReleaseResource\n> = async (params, flowgladServer: FlowgladServer) => {\n  if (params.method !== HTTPMethod.POST) {\n    return {\n      data: {},\n      status: 405,\n      error: {\n        code: 'Method not allowed',\n        json: {},\n      },\n    }\n  }\n\n  try {\n    const result = await flowgladServer.releaseResource(params.data)\n    return {\n      data: result,\n      status: 200,\n    }\n  } catch (error) {\n    return {\n      data: {},\n      status: 500,\n      error: {\n        code: 'release_resource_failed',\n        json: {\n          message: (error as Error).message,\n        },\n      },\n    }\n  }\n}\n\n/**\n * Handler for listing active resource claims for a subscription.\n * Can optionally filter by resource type using resourceSlug.\n * Validates HTTP method and delegates to FlowgladServer.listResourceClaims().\n */\nexport const listResourceClaims: SubRouteHandler<\n  FlowgladActionKey.ListResourceClaims\n> = async (params, flowgladServer: FlowgladServer) => {\n  if (params.method !== HTTPMethod.POST) {\n    return {\n      data: {},\n      status: 405,\n      error: {\n        code: 'Method not allowed',\n        json: {},\n      },\n    }\n  }\n\n  try {\n    const result = await flowgladServer.listResourceClaims(\n      params.data\n    )\n    return {\n      data: result,\n      status: 200,\n    }\n  } catch (error) {\n    return {\n      data: {},\n      status: 500,\n      error: {\n        code: 'list_resource_claims_failed',\n        json: {\n          message: (error as Error).message,\n        },\n      },\n    }\n  }\n}\n"],"mappings":"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","names":[]}