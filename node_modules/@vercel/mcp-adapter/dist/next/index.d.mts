import { ServerOptions as ServerOptions$1 } from '@modelcontextprotocol/sdk/server/index.js';
import { McpServer } from '@modelcontextprotocol/sdk/server/mcp.js';

type McpEventType = "SESSION_STARTED" | "SESSION_ENDED" | "REQUEST_RECEIVED" | "REQUEST_COMPLETED" | "ERROR";
interface McpEventBase {
    type: McpEventType;
    timestamp: number;
    sessionId?: string;
    requestId?: string;
}
interface McpSessionEvent extends McpEventBase {
    type: "SESSION_STARTED" | "SESSION_ENDED";
    transport: "SSE" | "HTTP";
    clientInfo?: {
        userAgent?: string;
        ip?: string;
    };
}
interface McpRequestEvent extends McpEventBase {
    type: "REQUEST_RECEIVED" | "REQUEST_COMPLETED";
    method: string;
    parameters?: unknown;
    result?: unknown;
    duration?: number;
    status: "success" | "error";
}
interface McpErrorEvent extends McpEventBase {
    type: "ERROR";
    error: Error | string;
    context?: string;
    source: "request" | "session" | "system";
    severity: "warning" | "error" | "fatal";
}
type McpEvent = McpSessionEvent | McpRequestEvent | McpErrorEvent;

/**
 * Configuration for the MCP handler.
 * @property redisUrl - The URL of the Redis instance to use for the MCP handler.
 * @property streamableHttpEndpoint - The endpoint to use for the streamable HTTP transport.
 * @property sseEndpoint - The endpoint to use for the SSE transport.
 * @property verboseLogs - If true, enables console logging.
 */
type Config = {
    /**
     * The URL of the Redis instance to use for the MCP handler.
     * @default process.env.REDIS_URL || process.env.KV_URL
     */
    redisUrl?: string;
    /**
     * The endpoint to use for the streamable HTTP transport.
     * @deprecated Use `set basePath` instead.
     * @default "/mcp"
     */
    streamableHttpEndpoint?: string;
    /**
     * The endpoint to use for the SSE transport.
     * @deprecated Use `set basePath` instead.
     * @default "/sse"
     */
    sseEndpoint?: string;
    /**
     * The endpoint to use for the SSE messages transport.
     * @deprecated Use `set basePath` instead.
     * @default "/message"
     */
    sseMessageEndpoint?: string;
    /**
     * The maximum duration of an MCP request in seconds.
     * @default 60
     */
    maxDuration?: number;
    /**
     * If true, enables console logging.
     * @default false
     */
    verboseLogs?: boolean;
    /**
     * The base path to use for deriving endpoints.
     * If provided, endpoints will be derived from this path.
     * For example, if basePath is "/", that means your routing is:
     *  /app/[transport]/route.ts and then:
     * - streamableHttpEndpoint will be "/mcp"
     * - sseEndpoint will be "/sse"
     * - sseMessageEndpoint will be "/message"
     * @default ""
     */
    basePath?: string;
    /**
     * Callback function that receives MCP events.
     * This can be used to track analytics, debug issues, or implement custom behaviors.
     */
    onEvent?: (event: McpEvent) => void;
    /**
     * If true, disables the SSE endpoint.
     * As of 2025-03-26, SSE is not supported by the MCP spec.
     * https://modelcontextprotocol.io/specification/2025-03-26/basic/transports
     * @default false
     */
    disableSse?: boolean;
};

/**
 * Creates a MCP handler that can be used to handle MCP requests.
 * @param initializeServer - A function that initializes the MCP server. Use this to access the server instance and register tools, prompts, and resources.
 * @param serverOptions - Options for the MCP server.
 * @param config - Configuration for the MCP handler.
 * @returns A function that can be used to handle MCP requests.
 */
type ServerOptions = ServerOptions$1 & {
    serverInfo?: {
        name: string;
        version: string;
    };
};
declare function createMcpRouteHandler(initializeServer: ((server: McpServer) => Promise<void>) | ((server: McpServer) => void), serverOptions?: ServerOptions, config?: Config): (request: Request) => Promise<Response>;

export { type ServerOptions, createMcpRouteHandler as default };
